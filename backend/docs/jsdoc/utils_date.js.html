<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>utils/date.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AppError.html">AppError</a></li><li><a href="AuthenticationError.html">AuthenticationError</a></li><li><a href="DatabaseError.html">DatabaseError</a></li><li><a href="EmailError.html">EmailError</a></li><li><a href="HealthService.html">HealthService</a><ul class='methods'><li data-type='method'><a href="HealthService.html#checkAuth">checkAuth</a></li><li data-type='method'><a href="HealthService.html#checkEmail">checkEmail</a></li><li data-type='method'><a href="HealthService.html#checkFirestore">checkFirestore</a></li><li data-type='method'><a href="HealthService.html#checkHealth">checkHealth</a></li><li data-type='method'><a href="HealthService.html#checkScheduler">checkScheduler</a></li><li data-type='method'><a href="HealthService.html#getLastScrapingStatus">getLastScrapingStatus</a></li><li data-type='method'><a href="HealthService.html#getMemoryUsage">getMemoryUsage</a></li><li data-type='method'><a href="HealthService.html#getMetrics">getMetrics</a></li></ul></li><li><a href="RateLimitError.html">RateLimitError</a></li><li><a href="ScraperError.html">ScraperError</a></li><li><a href="ValidationError.html">ValidationError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ERROR_CODES">ERROR_CODES</a></li><li><a href="global.html#asyncHandler">asyncHandler</a></li><li><a href="global.html#config">config</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatErrorResponse">formatErrorResponse</a></li><li><a href="global.html#formatYearMonth">formatYearMonth</a></li><li><a href="global.html#getKoreaDate">getKoreaDate</a></li><li><a href="global.html#getKoreaHour">getKoreaHour</a></li><li><a href="global.html#getMonthsFromSettings">getMonthsFromSettings</a></li><li><a href="global.html#getMonthsToScrape">getMonthsToScrape</a></li><li><a href="global.html#getRandomDelay">getRandomDelay</a></li><li><a href="global.html#isOperationalError">isOperationalError</a></li><li><a href="global.html#isRetryableError">isRetryableError</a></li><li><a href="global.html#isSleepTime">isSleepTime</a></li><li><a href="global.html#logRequestMiddleware">logRequestMiddleware</a></li><li><a href="global.html#notFoundHandler">notFoundHandler</a></li><li><a href="global.html#requestIdMiddleware">requestIdMiddleware</a></li><li><a href="global.html#retryIfRetryable">retryIfRetryable</a></li><li><a href="global.html#retryStrategies">retryStrategies</a></li><li><a href="global.html#retryWithBackoff">retryWithBackoff</a></li><li><a href="global.html#retryWithFixedDelay">retryWithFixedDelay</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#validateConfig">validateConfig</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">utils/date.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Get current date in Korea timezone (KST: UTC+9)
 */
export const getKoreaDate = () => {
  const now = new Date();
  const koreaTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));
  return koreaTime;
};

/**
 * Get current hour in Korea timezone (0-23)
 */
export const getKoreaHour = () => {
  return getKoreaDate().getHours();
};

/**
 * Check if current time is in sleep period (01:00 - 08:00 KST)
 */
export const isSleepTime = () => {
  const hour = getKoreaHour();
  return hour >= 1 &amp;&amp; hour &lt; 8;
};

/**
 * Format date to YYYY-MM-DD
 */
export const formatDate = date => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};

/**
 * Format date to YYYY-MM (for URL parameter)
 */
export const formatYearMonth = date => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  return `${year}-${month}`;
};

/**
 * Get array of months to scrape [current, next, next+1]
 */
export const getMonthsToScrape = () => {
  const now = getKoreaDate();
  const months = [];

  for (let i = 0; i &lt; 3; i++) {
    const date = new Date(now);
    date.setMonth(now.getMonth() + i);
    months.push(formatYearMonth(date));
  }

  return months;
};

/**
 * Get unique months from active user settings
 * @param {Array} activeSettings - Array of active user settings
 * @returns {Array} - Array of unique YYYY-MM strings sorted
 */
export const getMonthsFromSettings = activeSettings => {
  const monthsSet = new Set();

  for (const setting of activeSettings) {
    const dateFrom = setting.dateFrom ? new Date(setting.dateFrom) : null;
    const dateTo = setting.dateTo ? new Date(setting.dateTo) : null;

    // If no dates specified, skip this setting
    if (!dateFrom &amp;&amp; !dateTo) continue;

    // If only dateFrom exists, add that month
    if (dateFrom &amp;&amp; !dateTo) {
      monthsSet.add(formatYearMonth(dateFrom));
      continue;
    }

    // If only dateTo exists, add that month
    if (!dateFrom &amp;&amp; dateTo) {
      monthsSet.add(formatYearMonth(dateTo));
      continue;
    }

    // If both exist, add all months in the range
    if (dateFrom &amp;&amp; dateTo) {
      const start = new Date(dateFrom);
      const end = new Date(dateTo);

      const current = new Date(start.getFullYear(), start.getMonth(), 1);
      const endMonth = new Date(end.getFullYear(), end.getMonth(), 1);

      while (current &lt;= endMonth) {
        monthsSet.add(formatYearMonth(current));
        current.setMonth(current.getMonth() + 1);
      }
    }
  }

  // Convert Set to Array and sort
  return Array.from(monthsSet).sort();
};

/**
 * Get random delay between min and max seconds
 */
export const getRandomDelay = (minSeconds = 5, maxSeconds = 20) => {
  return Math.floor(Math.random() * (maxSeconds - minSeconds + 1) + minSeconds) * 1000;
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
