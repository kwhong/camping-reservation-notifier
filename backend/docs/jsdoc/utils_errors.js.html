<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>utils/errors.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AppError.html">AppError</a></li><li><a href="AuthenticationError.html">AuthenticationError</a></li><li><a href="DatabaseError.html">DatabaseError</a></li><li><a href="EmailError.html">EmailError</a></li><li><a href="HealthService.html">HealthService</a><ul class='methods'><li data-type='method'><a href="HealthService.html#checkAuth">checkAuth</a></li><li data-type='method'><a href="HealthService.html#checkEmail">checkEmail</a></li><li data-type='method'><a href="HealthService.html#checkFirestore">checkFirestore</a></li><li data-type='method'><a href="HealthService.html#checkHealth">checkHealth</a></li><li data-type='method'><a href="HealthService.html#checkScheduler">checkScheduler</a></li><li data-type='method'><a href="HealthService.html#getLastScrapingStatus">getLastScrapingStatus</a></li><li data-type='method'><a href="HealthService.html#getMemoryUsage">getMemoryUsage</a></li><li data-type='method'><a href="HealthService.html#getMetrics">getMetrics</a></li></ul></li><li><a href="NotificationService.html">NotificationService</a><ul class='methods'><li data-type='method'><a href="NotificationService.html#checkAndNotify">checkAndNotify</a></li><li data-type='method'><a href="NotificationService.html#hasSettingNotified">hasSettingNotified</a></li><li data-type='method'><a href="NotificationService.html#matchesCriteria">matchesCriteria</a></li><li data-type='method'><a href="NotificationService.html#sendEmailNotification">sendEmailNotification</a></li><li data-type='method'><a href="NotificationService.html#sendNotifications">sendNotifications</a></li></ul></li><li><a href="RateLimitError.html">RateLimitError</a></li><li><a href="ScraperError.html">ScraperError</a></li><li><a href="ScraperService.html">ScraperService</a><ul class='methods'><li data-type='method'><a href="ScraperService.html#parsePage">parsePage</a></li><li data-type='method'><a href="ScraperService.html#scrapeCampingSite">scrapeCampingSite</a></li></ul></li><li><a href="ValidationError.html">ValidationError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ERROR_CODES">ERROR_CODES</a></li><li><a href="global.html#asyncHandler">asyncHandler</a></li><li><a href="global.html#checkForActiveSettings">checkForActiveSettings</a></li><li><a href="global.html#config">config</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#executeScraping">executeScraping</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#formatErrorResponse">formatErrorResponse</a></li><li><a href="global.html#formatYearMonth">formatYearMonth</a></li><li><a href="global.html#getKoreaDate">getKoreaDate</a></li><li><a href="global.html#getKoreaHour">getKoreaHour</a></li><li><a href="global.html#getMonthsFromSettings">getMonthsFromSettings</a></li><li><a href="global.html#getMonthsToScrape">getMonthsToScrape</a></li><li><a href="global.html#getRandomDelay">getRandomDelay</a></li><li><a href="global.html#isOperationalError">isOperationalError</a></li><li><a href="global.html#isRetryableError">isRetryableError</a></li><li><a href="global.html#isSleepTime">isSleepTime</a></li><li><a href="global.html#logRequestMiddleware">logRequestMiddleware</a></li><li><a href="global.html#matchesSetting">matchesSetting</a></li><li><a href="global.html#notFoundHandler">notFoundHandler</a></li><li><a href="global.html#requestIdMiddleware">requestIdMiddleware</a></li><li><a href="global.html#retryIfRetryable">retryIfRetryable</a></li><li><a href="global.html#retryStrategies">retryStrategies</a></li><li><a href="global.html#retryWithBackoff">retryWithBackoff</a></li><li><a href="global.html#retryWithFixedDelay">retryWithFixedDelay</a></li><li><a href="global.html#runScrapingNow">runScrapingNow</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#startScheduler">startScheduler</a></li><li><a href="global.html#stopScheduler">stopScheduler</a></li><li><a href="global.html#validateConfig">validateConfig</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">utils/errors.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Custom Error Classes for Camping Scraper System
 */

/**
 * Base Application Error
 */
export class AppError extends Error {
  constructor(message, statusCode = 500, code = 'INTERNAL_ERROR', isOperational = true) {
    super(message);
    this.statusCode = statusCode;
    this.code = code;
    this.isOperational = isOperational;
    this.timestamp = new Date().toISOString();

    Error.captureStackTrace(this, this.constructor);
  }
}

/**
 * Authentication Errors
 */
export class AuthenticationError extends AppError {
  constructor(message, code = 'AUTH_FAILED') {
    super(message, 401, code);
  }
}

export class TokenExpiredError extends AuthenticationError {
  constructor(message = 'Authentication token has expired') {
    super(message, 'AUTH_TOKEN_EXPIRED');
  }
}

export class InvalidTokenError extends AuthenticationError {
  constructor(message = 'Invalid authentication token') {
    super(message, 'AUTH_INVALID_TOKEN');
  }
}

export class UnauthorizedError extends AppError {
  constructor(message = 'You are not authorized to perform this action') {
    super(message, 403, 'AUTH_UNAUTHORIZED');
  }
}

/**
 * Database Errors
 */
export class DatabaseError extends AppError {
  constructor(message, code = 'DB_ERROR') {
    super(message, 503, code);
  }
}

export class DatabaseConnectionError extends DatabaseError {
  constructor(message = 'Database connection failed') {
    super(message, 'DB_CONNECTION_ERROR');
  }
}

export class DatabaseQueryError extends DatabaseError {
  constructor(message = 'Database query failed') {
    super(message, 'DB_QUERY_FAILED');
  }
}

export class DocumentNotFoundError extends AppError {
  constructor(resource = 'Document', id = '') {
    const message = id ? `${resource} with id '${id}' not found` : `${resource} not found`;
    super(message, 404, 'DB_NOT_FOUND');
  }
}

/**
 * Scraper Errors
 */
export class ScraperError extends AppError {
  constructor(message, code = 'SCRAPER_ERROR') {
    super(message, 500, code);
  }
}

export class ScraperNetworkError extends ScraperError {
  constructor(message = 'Network error during scraping') {
    super(message, 'SCRAPER_NETWORK_ERROR');
  }
}

export class ScraperParseError extends ScraperError {
  constructor(message = 'Failed to parse scraped data') {
    super(message, 'SCRAPER_PARSE_ERROR');
  }
}

export class ScraperTimeoutError extends ScraperError {
  constructor(message = 'Scraping operation timed out') {
    super(message, 'SCRAPER_TIMEOUT');
  }
}

/**
 * Email Errors
 */
export class EmailError extends AppError {
  constructor(message = 'Email operation failed', code = 'EMAIL_ERROR') {
    super(message, 500, code);
  }
}

export class EmailSendError extends EmailError {
  constructor(message = 'Failed to send email') {
    super(message, 'EMAIL_SEND_FAILED');
  }
}

export class EmailConfigError extends EmailError {
  constructor(message = 'Email configuration error') {
    super(message, 'EMAIL_CONFIG_ERROR');
  }
}

/**
 * Validation Errors
 */
export class ValidationError extends AppError {
  constructor(message, fields = []) {
    super(message, 400, 'VALIDATION_ERROR');
    this.fields = fields;
  }
}

export class MissingParameterError extends ValidationError {
  constructor(paramName) {
    super(`Missing required parameter: ${paramName}`, [paramName]);
    this.code = 'MISSING_PARAMETER';
  }
}

export class InvalidParameterError extends ValidationError {
  constructor(paramName, reason = '') {
    const message = reason
      ? `Invalid parameter '${paramName}': ${reason}`
      : `Invalid parameter: ${paramName}`;
    super(message, [paramName]);
    this.code = 'INVALID_PARAMETER';
  }
}

/**
 * Rate Limit Error
 */
export class RateLimitError extends AppError {
  constructor(message = 'Too many requests, please try again later') {
    super(message, 429, 'RATE_LIMIT_EXCEEDED');
  }
}

/**
 * Error Code Reference
 */
export const ERROR_CODES = {
  // Authentication (401)
  AUTH_FAILED: { status: 401, message: 'Authentication failed' },
  AUTH_TOKEN_EXPIRED: { status: 401, message: 'Token expired' },
  AUTH_INVALID_TOKEN: { status: 401, message: 'Invalid token' },
  AUTH_NO_TOKEN: { status: 401, message: 'No token provided' },

  // Authorization (403)
  AUTH_UNAUTHORIZED: { status: 403, message: 'Unauthorized access' },

  // Not Found (404)
  DB_NOT_FOUND: { status: 404, message: 'Resource not found' },

  // Validation (400)
  VALIDATION_ERROR: { status: 400, message: 'Validation error' },
  MISSING_PARAMETER: { status: 400, message: 'Missing required parameter' },
  INVALID_PARAMETER: { status: 400, message: 'Invalid parameter' },

  // Rate Limit (429)
  RATE_LIMIT_EXCEEDED: { status: 429, message: 'Rate limit exceeded' },

  // Server Errors (500)
  INTERNAL_ERROR: { status: 500, message: 'Internal server error' },
  DB_ERROR: { status: 500, message: 'Database error' },
  DB_QUERY_FAILED: { status: 500, message: 'Database query failed' },
  SCRAPER_ERROR: { status: 500, message: 'Scraper error' },
  SCRAPER_PARSE_ERROR: { status: 500, message: 'Failed to parse data' },
  EMAIL_ERROR: { status: 500, message: 'Email error' },
  EMAIL_SEND_FAILED: { status: 500, message: 'Failed to send email' },
  EMAIL_CONFIG_ERROR: { status: 500, message: 'Email configuration error' },

  // Service Unavailable (503)
  DB_CONNECTION_ERROR: { status: 503, message: 'Database unavailable' },
  SCRAPER_NETWORK_ERROR: { status: 503, message: 'Network error' },
  SCRAPER_TIMEOUT: { status: 503, message: 'Operation timed out' }
};

/**
 * Check if error is operational (expected)
 */
export function isOperationalError(error) {
  if (error instanceof AppError) {
    return error.isOperational;
  }
  return false;
}

/**
 * Format error for API response
 */
export function formatErrorResponse(error) {
  if (error instanceof AppError) {
    return {
      error: error.message,
      code: error.code,
      statusCode: error.statusCode,
      timestamp: error.timestamp,
      ...(error instanceof ValidationError &amp;&amp; { fields: error.fields })
    };
  }

  // Unknown error
  return {
    error: 'Internal server error',
    code: 'INTERNAL_ERROR',
    statusCode: 500,
    timestamp: new Date().toISOString()
  };
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
