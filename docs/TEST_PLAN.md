# 캠핑 예약 알림 시스템 테스트 계획서

## 목차
1. [단위 테스트 목록](#1-단위-테스트-목록)
   - [1.1 프론트엔드 화면별 단위 테스트](#11-프론트엔드-화면별-단위-테스트)
   - [1.2 백엔드 서비스별 단위 테스트](#12-백엔드-서비스별-단위-테스트)
2. [통합 테스트 시나리오](#2-통합-테스트-시나리오)
3. [테스트 실행 방법](#3-테스트-실행-방법)

---

## 1. 단위 테스트 목록

### 1.1 프론트엔드 화면별 단위 테스트

#### TC-FE-001: Login.jsx - 로그인 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-001-01 | 화면 렌더링 | 로그인 폼이 정상 표시되는지 확인 | 이메일, 비밀번호 입력필드 및 로그인/Google 로그인 버튼 표시 |
| TC-FE-001-02 | 이메일 유효성 검증 | 잘못된 이메일 형식 입력 시 검증 | 이메일 형식 오류 메시지 표시 |
| TC-FE-001-03 | 필수 입력 검증 | 빈 입력값으로 로그인 시도 | 필수 입력 오류 메시지 표시 |
| TC-FE-001-04 | 이메일 로그인 성공 | 올바른 계정 정보로 로그인 | AuthContext의 signInWithEmail 호출 및 대시보드 이동 |
| TC-FE-001-05 | Google 로그인 실행 | Google 로그인 버튼 클릭 | signInWithGoogle 호출 |
| TC-FE-001-06 | 로그인 실패 처리 | 잘못된 계정 정보로 로그인 | 로그인 실패 메시지 표시 |
| TC-FE-001-07 | 로딩 상태 표시 | 로그인 중 로딩 UI 표시 | 로딩 스피너/버튼 비활성화 |

#### TC-FE-002: Dashboard.jsx - 대시보드 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-002-01 | 화면 렌더링 | 대시보드 메인 화면 정상 표시 | 사용자 정보, 네비게이션 메뉴 표시 |
| TC-FE-002-02 | 메뉴 탭 전환 | 각 메뉴 탭 클릭 시 화면 전환 | 예약 현황/알림 설정/로그 화면 전환 |
| TC-FE-002-03 | 사용자 정보 표시 | 로그인한 사용자 정보 표시 | 이메일, 표시명 출력 |
| TC-FE-002-04 | 로그아웃 기능 | 로그아웃 버튼 클릭 | 로그아웃 처리 및 로그인 화면 이동 |
| TC-FE-002-05 | 프로필 업데이트 | 사용자 프로필 수정 | API 호출 및 정보 업데이트 |

#### TC-FE-003: AvailableSites.jsx - 예약 현황 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-003-01 | 화면 렌더링 | 예약 현황 화면 정상 표시 | 검색 필터 및 결과 테이블 표시 |
| TC-FE-003-02 | 데이터 로딩 | 예약 가능 데이터 조회 | API 호출 및 데이터 테이블 표시 |
| TC-FE-003-03 | 날짜 필터 적용 | 날짜 범위 선택 및 검색 | 선택된 날짜 범위의 데이터만 표시 |
| TC-FE-003-04 | 캠핑장 필터 적용 | 캠핑장 선택 및 검색 | 선택된 캠핑장 데이터만 표시 |
| TC-FE-003-05 | 구역 필터 적용 | 구역 선택 및 검색 | 선택된 구역 데이터만 표시 |
| TC-FE-003-06 | 데이터 없음 표시 | 검색 결과가 없을 때 | "데이터가 없습니다" 메시지 표시 |
| TC-FE-003-07 | 로딩 상태 표시 | 데이터 조회 중 | 로딩 스피너 표시 |
| TC-FE-003-08 | 에러 처리 | API 오류 발생 시 | 에러 메시지 표시 |
| TC-FE-003-09 | 테이블 정렬 | 컬럼 헤더 클릭 시 정렬 | 날짜/구역/가용 수 정렬 |
| TC-FE-003-10 | 데이터 새로고침 | 새로고침 버튼 클릭 | 최신 데이터 재조회 |

#### TC-FE-004: UserSettings.jsx - 알림 설정 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-004-01 | 화면 렌더링 | 알림 설정 화면 정상 표시 | 설정 목록 및 추가 버튼 표시 |
| TC-FE-004-02 | 설정 목록 조회 | 사용자 설정 목록 로딩 | API 호출 및 설정 목록 표시 |
| TC-FE-004-03 | 신규 설정 추가 폼 | 추가 버튼 클릭 | 설정 입력 폼 표시 |
| TC-FE-004-04 | 필수 입력 검증 | 필수 항목 누락 시 저장 | 필수 입력 오류 메시지 표시 |
| TC-FE-004-05 | 날짜 유효성 검증 | 종료일이 시작일보다 빠를 때 | 날짜 오류 메시지 표시 |
| TC-FE-004-06 | 구역 선택 검증 | 구역 미선택 시 저장 | 구역 선택 오류 메시지 표시 |
| TC-FE-004-07 | 설정 저장 성공 | 올바른 정보 입력 후 저장 | API 호출 및 목록 갱신 |
| TC-FE-004-08 | 설정 수정 | 기존 설정 수정 | 수정 폼 표시 및 저장 |
| TC-FE-004-09 | 설정 삭제 | 설정 삭제 버튼 클릭 | 삭제 확인 후 API 호출 및 목록 갱신 |
| TC-FE-004-10 | 설정 활성화/비활성화 | 토글 스위치 클릭 | isActive 상태 변경 |
| TC-FE-004-11 | 이메일 수신 주소 변경 | 알림 받을 이메일 수정 | 이메일 유효성 검증 및 저장 |
| TC-FE-004-12 | 빈 목록 표시 | 설정이 없을 때 | "설정이 없습니다" 메시지 표시 |

#### TC-FE-005: NotificationLogs.jsx - 알림 로그 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-005-01 | 화면 렌더링 | 알림 로그 화면 정상 표시 | 로그 테이블 표시 |
| TC-FE-005-02 | 로그 목록 조회 | 알림 전송 로그 조회 | API 호출 및 로그 목록 표시 |
| TC-FE-005-03 | 날짜 필터 적용 | 날짜 범위 필터링 | 선택된 날짜 범위의 로그만 표시 |
| TC-FE-005-04 | 로그 정렬 | 최신순/오래된순 정렬 | sentAt 기준 정렬 |
| TC-FE-005-05 | 상세 정보 표시 | 로그 항목 클릭 | 알림 상세 정보 모달 표시 |
| TC-FE-005-06 | 빈 로그 표시 | 로그가 없을 때 | "로그가 없습니다" 메시지 표시 |
| TC-FE-005-07 | 페이지네이션 | 다음/이전 페이지 이동 | 페이지별 로그 표시 |

#### TC-FE-006: ScrapingLogs.jsx - 스크래핑 로그 화면
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-006-01 | 화면 렌더링 | 스크래핑 로그 화면 정상 표시 | 로그 테이블 표시 |
| TC-FE-006-02 | 로그 목록 조회 | 스크래핑 실행 로그 조회 | API 호출 및 로그 목록 표시 |
| TC-FE-006-03 | 상태별 필터 | 성공/실패/실행중 필터링 | 선택된 상태의 로그만 표시 |
| TC-FE-006-04 | 날짜 필터 적용 | 날짜 범위 필터링 | 선택된 날짜 범위의 로그만 표시 |
| TC-FE-006-05 | 에러 로그 상세 | 실패 로그 클릭 | errorMessage 표시 |
| TC-FE-006-06 | 실행 시간 표시 | 각 로그의 실행 시간 계산 | completedAt - startedAt 표시 |
| TC-FE-006-07 | 스크랩 항목 수 표시 | itemsScraped 수치 표시 | 정수형 표시 |
| TC-FE-006-08 | 로그 정렬 | 최신순 정렬 | startedAt 기준 내림차순 |

#### TC-FE-007: AuthContext.jsx - 인증 컨텍스트
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-007-01 | 컨텍스트 초기화 | AuthProvider 마운트 | onAuthStateChanged 리스너 등록 |
| TC-FE-007-02 | 로그인 상태 유지 | 페이지 새로고침 | Firebase 세션으로 자동 로그인 |
| TC-FE-007-03 | 토큰 갱신 | 토큰 만료 시 | 자동 토큰 재발급 |
| TC-FE-007-04 | 로그아웃 처리 | logout 함수 호출 | Firebase 로그아웃 및 상태 초기화 |

#### TC-FE-008: PrivateRoute.jsx - 라우트 보호
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-FE-008-01 | 인증된 사용자 접근 | 로그인 상태에서 보호된 라우트 접근 | 정상 화면 표시 |
| TC-FE-008-02 | 미인증 사용자 리다이렉트 | 비로그인 상태에서 보호된 라우트 접근 | 로그인 화면으로 리다이렉트 |
| TC-FE-008-03 | 로딩 상태 처리 | 인증 확인 중 | 로딩 스피너 표시 |

---

### 1.2 백엔드 서비스별 단위 테스트

#### TC-BE-001: scraper.service.js - 스크래핑 서비스
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-001-01 | Playwright 브라우저 시작 | launchBrowser 호출 | Chromium 브라우저 인스턴스 생성 |
| TC-BE-001-02 | 페이지 네비게이션 | mirihae.com 접속 | 페이지 로딩 성공 |
| TC-BE-001-03 | 월별 버튼 클릭 | 각 월 버튼 클릭 및 대기 | 월별 예약 현황 표시 |
| TC-BE-001-04 | 날짜 div 파싱 | `<div id="YYYY-MM-DD">` 추출 | 날짜 목록 배열 반환 |
| TC-BE-001-05 | 구역 이름 파싱 | `<dd>` 태그 텍스트 추출 | 구역명 문자열 추출 |
| TC-BE-001-06 | 가용 수 파싱 | `<dt>` 태그 숫자 추출 | 정수형 availableCount 반환 |
| TC-BE-001-07 | dl.schedule 구조 파싱 | HTML 구조 분석 | 구역별 가용 데이터 추출 |
| TC-BE-001-08 | 다중 월 스크래핑 | 3개월 데이터 수집 | 모든 월의 데이터 반환 |
| TC-BE-001-09 | 스크래핑 실패 처리 | 페이지 로딩 실패 시 | 에러 throw 및 로그 기록 |
| TC-BE-001-10 | 브라우저 종료 | 스크래핑 완료/실패 후 | 브라우저 정상 종료 |
| TC-BE-001-11 | 데이터 정제 | 추출된 데이터 정규화 | 빈 값/중복 제거 |
| TC-BE-001-12 | 동적 월 선택 | getMonthsFromSettings 기반 월 추출 | 사용자 설정의 dateFrom/dateTo 기반 월 목록 반환 |

#### TC-BE-002: notification.service.js - 알림 서비스
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-002-01 | 활성 설정 조회 | isActive=true 설정 필터링 | 활성 설정 목록 반환 |
| TC-BE-002-02 | 캠핑장명 매칭 | campingName 조건 확인 | 일치하는 데이터만 필터링 |
| TC-BE-002-03 | 구역 매칭 (OR 로직) | area[] 배열과 매칭 | 하나라도 일치하면 true |
| TC-BE-002-04 | 날짜 범위 매칭 | dateFrom ~ dateTo 범위 확인 | 범위 내 날짜만 true |
| TC-BE-002-05 | 지역 매칭 | region 조건 확인 | 일치하는 지역만 true |
| TC-BE-002-06 | 이메일 전송 | nodemailer sendMail 호출 | 이메일 전송 성공 |
| TC-BE-002-07 | 알림 로그 저장 | notifications 컬렉션 저장 | Firestore 저장 성공 |
| TC-BE-002-08 | 설정 자동 비활성화 | 알림 전송 후 isActive=false | userSettings 업데이트 |
| TC-BE-002-09 | 중복 알림 방지 | 동일 settingId 재전송 방지 | 이미 전송된 설정은 skip |
| TC-BE-002-10 | 여러 조건 동시 매칭 | 복수 설정 동시 만족 | 각 설정별 알림 전송 |
| TC-BE-002-11 | 이메일 전송 실패 처리 | SMTP 오류 발생 | 에러 로그 기록 및 재시도 |
| TC-BE-002-12 | notificationEmail 사용 | 사용자 지정 수신 이메일 | notificationEmail로 전송 |

#### TC-BE-003: scheduler.service.js - 스케줄러 서비스
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-003-01 | 스케줄러 시작 | startScheduler 호출 | cron job 등록 (10분 간격) |
| TC-BE-003-02 | 랜덤 지연 실행 | getRandomDelay 적용 | 30-120초 랜덤 대기 |
| TC-BE-003-03 | 취침 시간 체크 | 01:00-08:00 KST 확인 | isSleepTime=true 시 skip |
| TC-BE-003-04 | 활성 설정 존재 확인 | hasActiveFutureSettings 호출 | 활성 설정 없으면 skip |
| TC-BE-003-05 | 스크래핑 실행 | scrapeAllCampingSites 호출 | 스크래핑 정상 실행 |
| TC-BE-003-06 | 알림 체크 실행 | checkAndNotify 호출 | 알림 조건 확인 및 전송 |
| TC-BE-003-07 | 로그 기록 | scrapingLogs 저장 | 실행 시작/완료 로그 저장 |
| TC-BE-003-08 | 에러 핸들링 | 스크래핑 실패 시 | 에러 로그 저장 및 계속 실행 |
| TC-BE-003-09 | 수동 실행 | runScrapingNow 호출 | 즉시 스크래핑 실행 (스케줄 무시) |
| TC-BE-003-10 | 스케줄러 중지 | stopScheduler 호출 | cron job 중지 |

#### TC-BE-004: firestore.service.js - Firestore 서비스
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-004-01 | 사용자 생성 | createUser 호출 | users 컬렉션에 문서 생성 |
| TC-BE-004-02 | 사용자 조회 | getUserByUid 호출 | 사용자 문서 반환 |
| TC-BE-004-03 | 사용자 업데이트 | updateUser 호출 | 사용자 정보 업데이트 |
| TC-BE-004-04 | 설정 생성 | createUserSetting 호출 | userSettings 컬렉션에 문서 생성 |
| TC-BE-004-05 | 설정 목록 조회 | getUserSettings 호출 | userId 기준 설정 목록 반환 |
| TC-BE-004-06 | 설정 업데이트 | updateUserSetting 호출 | 설정 정보 업데이트 |
| TC-BE-004-07 | 설정 삭제 | deleteUserSetting 호출 | 문서 삭제 |
| TC-BE-004-08 | 가용성 저장 | saveAvailability 호출 | availability 컬렉션에 배치 저장 |
| TC-BE-004-09 | 가용성 조회 | getAvailability 호출 | 조건별 필터링 데이터 반환 |
| TC-BE-004-10 | 알림 로그 저장 | saveNotificationLog 호출 | notifications 컬렉션에 저장 |
| TC-BE-004-11 | 알림 로그 조회 | getNotificationLogs 호출 | userId 기준 로그 반환 |
| TC-BE-004-12 | 스크래핑 로그 저장 | saveScrapingLog 호출 | scrapingLogs 컬렉션에 저장 |
| TC-BE-004-13 | 스크래핑 로그 조회 | getScrapingLogs 호출 | 로그 목록 반환 |
| TC-BE-004-14 | 활성 설정 존재 확인 | hasActiveFutureSettings 호출 | 미래 날짜의 활성 설정 존재 여부 반환 |

#### TC-BE-005: auth.middleware.js - 인증 미들웨어
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-005-01 | 토큰 파싱 | Authorization 헤더 추출 | Bearer 토큰 파싱 |
| TC-BE-005-02 | 토큰 검증 | Firebase Admin verifyIdToken | 유효한 토큰 인증 성공 |
| TC-BE-005-03 | 토큰 없음 처리 | Authorization 헤더 누락 | 401 Unauthorized 반환 |
| TC-BE-005-04 | 잘못된 토큰 처리 | 만료/변조된 토큰 | 401 Unauthorized 반환 |
| TC-BE-005-05 | req.user 설정 | 인증 성공 시 | decodedToken을 req.user에 저장 |

#### TC-BE-006: date.js - 날짜 유틸리티
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-006-01 | 한국 현재 시간 조회 | getKoreaDate 호출 | UTC+9 시간 반환 |
| TC-BE-006-02 | 취침 시간 체크 (참) | isSleepTime(02:00 KST) | true 반환 |
| TC-BE-006-03 | 취침 시간 체크 (거짓) | isSleepTime(10:00 KST) | false 반환 |
| TC-BE-006-04 | 경계값 테스트 (01:00) | isSleepTime(01:00 KST) | true 반환 |
| TC-BE-006-05 | 경계값 테스트 (08:00) | isSleepTime(08:00 KST) | false 반환 |
| TC-BE-006-06 | 기본 월 목록 조회 | getMonthsToScrape() | 현재월, +1월, +2월 배열 반환 |
| TC-BE-006-07 | 설정 기반 월 목록 | getMonthsFromSettings(settings) | dateFrom~dateTo의 모든 월 반환 |
| TC-BE-006-08 | 랜덤 지연 생성 | getRandomDelay(30000, 120000) | 30000~120000 사이 정수 반환 |

#### TC-BE-007: Routes - API 엔드포인트
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-007-01 | GET /health | 헬스체크 | 200 OK, status: "ok" |
| TC-BE-007-02 | GET /api/auth/verify | 토큰 검증 | 200 OK, 사용자 정보 반환 |
| TC-BE-007-03 | PUT /api/auth/profile | 프로필 업데이트 | 200 OK, 업데이트 성공 |
| TC-BE-007-04 | POST /api/settings | 설정 생성 | 201 Created, 설정 ID 반환 |
| TC-BE-007-05 | GET /api/settings | 설정 목록 조회 | 200 OK, 설정 배열 반환 |
| TC-BE-007-06 | GET /api/settings/:id | 설정 단건 조회 | 200 OK, 설정 객체 반환 |
| TC-BE-007-07 | PUT /api/settings/:id | 설정 수정 | 200 OK, 수정 성공 |
| TC-BE-007-08 | DELETE /api/settings/:id | 설정 삭제 | 200 OK, 삭제 성공 |
| TC-BE-007-09 | GET /api/availability | 예약 가능 조회 | 200 OK, 가용성 데이터 배열 |
| TC-BE-007-10 | GET /api/logs/notifications | 알림 로그 조회 | 200 OK, 로그 배열 반환 |
| TC-BE-007-11 | GET /api/logs/scraping | 스크래핑 로그 조회 | 200 OK, 로그 배열 반환 |
| TC-BE-007-12 | 인증 필요 라우트 | 토큰 없이 API 호출 | 401 Unauthorized |

#### TC-BE-008: error.middleware.js - 에러 처리 미들웨어
| 테스트ID | 테스트명 | 테스트 내용 | 예상 결과 |
|---------|---------|-----------|----------|
| TC-BE-008-01 | 일반 에러 처리 | throw new Error | 500 Internal Server Error |
| TC-BE-008-02 | 커스텀 에러 처리 | AppError throw | statusCode, message 포함 응답 |
| TC-BE-008-03 | 404 Not Found | 존재하지 않는 라우트 | 404 에러 반환 |
| TC-BE-008-04 | 에러 로그 기록 | 에러 발생 시 | 콘솔/파일 로그 기록 |

---

## 2. 통합 테스트 시나리오

### IT-001: 사용자 회원가입 및 로그인 통합 시나리오
**목적**: 신규 사용자 회원가입부터 로그인, 프로필 설정까지 전체 인증 플로우 검증

**전제조건**:
- 백엔드 서버 실행 중 (http://localhost:3000)
- 프론트엔드 서버 실행 중 (http://localhost:5173)
- Firebase 인증 설정 완료

**테스트 단계**:
1. 브라우저에서 http://localhost:5173 접속
2. 로그인 화면에서 이메일/비밀번호 입력 (신규 계정)
3. 로그인 버튼 클릭
4. Firebase Authentication에 계정 생성 확인
5. 대시보드 화면 자동 이동 확인
6. 사용자 정보 표시 확인 (이메일, displayName)
7. 프로필 수정 (notificationEmail 변경)
8. 변경사항 저장 및 Firestore users 컬렉션 업데이트 확인
9. 로그아웃 후 동일 계정으로 재로그인
10. 변경된 프로필 정보 유지 확인

**예상 결과**:
- 신규 사용자 Firestore users 컬렉션 생성
- JWT 토큰 정상 발급 및 저장
- 프로필 정보 정상 업데이트
- 로그인 상태 유지 및 재인증 성공

---

### IT-002: Google OAuth 로그인 통합 시나리오
**목적**: Google 소셜 로그인 기능 검증

**전제조건**:
- Firebase Google OAuth 설정 완료
- 테스트용 Google 계정 준비

**테스트 단계**:
1. 로그인 화면에서 "Google로 로그인" 버튼 클릭
2. Google 로그인 팝업 창 표시 확인
3. Google 계정 선택 및 인증
4. Firebase Authentication에 계정 생성 확인
5. 대시보드 자동 이동
6. Google 계정 정보 (이메일, 이름) 표시 확인
7. Firestore users 컬렉션에 사용자 문서 생성 확인

**예상 결과**:
- Google OAuth 인증 성공
- Firebase에 Google provider 계정 생성
- 대시보드 정상 접근
- 사용자 정보 Firestore 저장

---

### IT-003: 알림 설정 생성 및 수정 통합 시나리오
**목적**: 캠핑 예약 알림 설정의 CRUD 기능 검증

**전제조건**:
- 로그인된 사용자 계정

**테스트 단계**:
1. 대시보드에서 "알림 설정" 탭 클릭
2. "새 설정 추가" 버튼 클릭
3. 설정 입력:
   - 캠핑장명: 다리안계곡캠핑장
   - 지역: 경기
   - 구역: ["A구역", "B구역"] 선택
   - 날짜 범위: 2025-05-01 ~ 2025-05-03
   - 알림 이메일: test@example.com
   - 활성화: true
4. 저장 버튼 클릭
5. API 호출 확인 (POST /api/settings)
6. Firestore userSettings 컬렉션 저장 확인
7. 설정 목록에 새 항목 표시 확인
8. 생성된 설정 수정 (구역 추가: "C구역")
9. 수정 저장 및 API 호출 확인 (PUT /api/settings/:id)
10. 설정 비활성화 (isActive: false)
11. 설정 삭제 버튼 클릭
12. 삭제 확인 팝업 승인
13. API 호출 확인 (DELETE /api/settings/:id)
14. 설정 목록에서 삭제된 항목 제거 확인

**예상 결과**:
- 설정 생성/수정/삭제 모두 정상 동작
- Firestore 데이터 실시간 동기화
- 유효성 검증 정상 동작
- UI 상태 업데이트 정상

---

### IT-004: 스크래핑 실행 및 데이터 저장 통합 시나리오
**목적**: 자동 스크래핑 실행 및 Firestore 저장 검증

**전제조건**:
- 백엔드 서버 실행 중
- Playwright 브라우저 설치 완료
- 활성화된 사용자 설정 존재

**테스트 단계**:
1. 백엔드 서버 시작 시 startScheduler() 자동 실행 확인
2. 10분 대기 또는 runScrapingNow() 수동 호출
3. 콘솔 로그에서 "🚀 스크래핑 시작" 메시지 확인
4. Playwright 브라우저 실행 확인
5. mirihae.com 페이지 접속 확인
6. 3개월 버튼 클릭 및 데이터 파싱 진행
7. 콘솔에서 파싱된 데이터 개수 확인
8. Firestore availability 컬렉션에 데이터 저장 확인
9. scrapingLogs 컬렉션에 로그 기록 확인:
   - startedAt, completedAt 타임스탬프
   - status: "success"
   - itemsScraped: 정수값
10. 브라우저 종료 확인
11. 콘솔에서 "✅ 스크래핑 완료" 메시지 확인

**예상 결과**:
- 스크래핑 정상 실행
- 수백 개의 availability 데이터 저장
- 로그 정상 기록
- 브라우저 리소스 정상 해제

---

### IT-005: 스크래핑 실패 처리 통합 시나리오
**목적**: 네트워크 오류/사이트 변경 시 에러 핸들링 검증

**전제조건**:
- 네트워크 단절 또는 잘못된 URL 설정

**테스트 단계**:
1. scraper.service.js의 URL을 잘못된 주소로 변경 (또는 네트워크 차단)
2. runScrapingNow() 호출
3. 콘솔에서 에러 로그 확인 (❌)
4. Firestore scrapingLogs 컬렉션 확인:
   - status: "error"
   - errorMessage: 에러 내용
5. 스케줄러가 중단되지 않고 계속 실행되는지 확인
6. 다음 스케줄 실행 시 재시도 확인

**예상 결과**:
- 에러 정상 catch 및 로그 기록
- 스케줄러 계속 실행
- 사용자에게 알림 미전송

---

### IT-006: 알림 매칭 및 이메일 전송 통합 시나리오
**목적**: 스크래핑 데이터와 사용자 설정 매칭 후 이메일 전송 검증

**전제조건**:
- 활성화된 사용자 설정:
  - campingName: "다리안계곡캠핑장"
  - region: "경기"
  - area: ["A구역"]
  - dateFrom: 2025-05-01
  - dateTo: 2025-05-03
  - isActive: true
- Gmail SMTP 설정 완료 (EMAIL_USER, EMAIL_APP_PASSWORD)

**테스트 단계**:
1. 위 조건에 맞는 availability 데이터 Firestore에 생성:
   - campingName: "다리안계곡캠핑장"
   - region: "경기"
   - area: "A구역"
   - date: 2025-05-02
   - availableCount: 5
2. checkAndNotify() 함수 실행
3. 콘솔에서 "✅ 조건 매칭" 메시지 확인
4. nodemailer sendMail 호출 확인
5. Gmail 계정에서 이메일 수신 확인:
   - 제목: "[캠핑 예약 알림]..."
   - 본문: 캠핑장명, 구역, 날짜, 가용 수 포함
6. Firestore notifications 컬렉션에 로그 저장 확인:
   - userId, settingId
   - notificationType: "email"
   - sentAt 타임스탬프
7. userSettings 컬렉션에서 해당 설정 isActive=false로 변경 확인

**예상 결과**:
- 조건 정확히 매칭
- 이메일 정상 전송 및 수신
- 알림 로그 저장
- 설정 자동 비활성화 (재알림 방지)

---

### IT-007: 중복 알림 방지 통합 시나리오
**목적**: 동일 설정에 대한 중복 알림 전송 방지 검증

**전제조건**:
- 이미 알림이 전송된 설정 (notifications 컬렉션에 로그 존재)

**테스트 단계**:
1. 알림이 전송된 settingId로 다시 조건 매칭 시도
2. checkAndNotify() 실행
3. 콘솔에서 "이미 전송된 알림" 메시지 확인
4. nodemailer sendMail 호출되지 않음 확인
5. notifications 컬렉션에 중복 로그 생성되지 않음 확인

**예상 결과**:
- 중복 알림 차단
- 이메일 미전송
- 로그 중복 생성 방지

---

### IT-008: 스케줄러 취침 시간 스킵 통합 시나리오
**목적**: 01:00-08:00 KST 시간대 스크래핑 건너뛰기 검증

**전제조건**:
- 시스템 시간을 KST 02:00으로 설정 (또는 date.js 모킹)

**테스트 단계**:
1. 시스템 시간 02:00 KST로 설정
2. 스케줄러 실행 트리거
3. isSleepTime() 호출 결과 true 확인
4. 콘솔에서 "😴 취침 시간" 메시지 확인
5. scrapeAllCampingSites 호출되지 않음 확인
6. 시스템 시간 10:00 KST로 변경
7. 다음 스케줄 실행 시 정상 스크래핑 확인

**예상 결과**:
- 취침 시간대 스크래핑 건너뛰기
- 정상 시간대 재개

---

### IT-009: 예약 현황 조회 및 필터링 통합 시나리오
**목적**: 프론트엔드 예약 현황 화면에서 필터링 기능 검증

**전제조건**:
- Firestore availability 컬렉션에 다양한 데이터 존재
- 로그인된 사용자

**테스트 단계**:
1. 대시보드에서 "예약 현황" 탭 클릭
2. API 호출 확인 (GET /api/availability)
3. 전체 데이터 테이블 표시 확인
4. 날짜 필터 적용 (2025-05-01 ~ 2025-05-03)
5. API 재호출 및 필터링된 데이터 표시 확인
6. 캠핑장 필터 추가 ("다리안계곡캠핑장")
7. 구역 필터 추가 ("A구역")
8. 모든 필터 조건 만족하는 데이터만 표시 확인
9. 필터 초기화 버튼 클릭
10. 전체 데이터 다시 표시 확인
11. 테이블 정렬 테스트 (날짜 컬럼 클릭 → 오름차순/내림차순)
12. 가용 수 컬럼 정렬 테스트

**예상 결과**:
- 필터링 정확히 동작
- UI 실시간 업데이트
- API 쿼리 최적화
- 정렬 정상 동작

---

### IT-010: 알림 로그 조회 통합 시나리오
**목적**: 알림 전송 이력 조회 기능 검증

**전제조건**:
- notifications 컬렉션에 사용자별 로그 존재

**테스트 단계**:
1. 대시보드에서 "알림 로그" 탭 클릭
2. API 호출 확인 (GET /api/logs/notifications)
3. 로그 테이블 표시 확인 (최신순 정렬)
4. 각 로그 항목 정보 확인:
   - campingName, area, date
   - notificationType, sentAt
5. 날짜 필터 적용 (최근 7일)
6. 필터링된 로그 표시 확인
7. 로그 항목 클릭 → 상세 모달 표시
8. 상세 정보 확인 (settingId, availableCount 등)

**예상 결과**:
- 로그 정확히 조회
- 날짜 필터 정상 동작
- 상세 정보 표시

---

### IT-011: 스크래핑 로그 조회 통합 시나리오
**목적**: 스크래핑 실행 이력 및 에러 로그 조회 검증

**전제조건**:
- scrapingLogs 컬렉션에 성공/실패 로그 존재

**테스트 단계**:
1. 대시보드에서 "스크래핑 로그" 탭 클릭
2. API 호출 확인 (GET /api/logs/scraping)
3. 로그 테이블 표시 (최신순)
4. 각 로그 항목 정보 확인:
   - status (success/error/running)
   - startedAt, completedAt
   - itemsScraped
5. 상태 필터 적용 ("error")
6. 실패 로그만 표시 확인
7. 실패 로그 클릭 → errorMessage 표시
8. 실행 시간 계산 확인 (completedAt - startedAt)
9. 날짜 필터 적용 (최근 1일)

**예상 결과**:
- 로그 정확히 조회
- 상태별 필터링 정상
- 에러 메시지 표시
- 실행 시간 계산 정확

---

### IT-012: 동적 월 선택 스크래핑 통합 시나리오
**목적**: 사용자 설정의 날짜 범위 기반 동적 월 스크래핑 검증

**전제조건**:
- 사용자 설정 2개:
  1. dateFrom: 2025-04-15, dateTo: 2025-04-20
  2. dateFrom: 2025-06-01, dateTo: 2025-06-10

**테스트 단계**:
1. getMonthsFromSettings() 호출
2. 반환된 월 목록 확인: ["2025-04", "2025-06"]
3. scrapeAllCampingSites 실행
4. 2025년 4월, 6월 버튼만 클릭하는지 확인
5. 해당 월의 데이터만 스크래핑되는지 확인
6. Firestore availability에 저장된 데이터 날짜 확인

**예상 결과**:
- 설정된 월만 스크래핑
- 불필요한 월 스크래핑 방지
- 스크래핑 시간 최적화

---

### IT-013: 토큰 만료 및 재인증 통합 시나리오
**목적**: JWT 토큰 만료 시 자동 재인증 검증

**전제조건**:
- 로그인된 사용자
- 토큰 만료 시뮬레이션 가능

**테스트 단계**:
1. 로그인 후 API 호출 성공 확인
2. Firebase 토큰 수동 만료 (또는 1시간 대기)
3. API 호출 시도 (GET /api/settings)
4. axios interceptor에서 토큰 갱신 시도 확인
5. Firebase getIdToken(true) 호출 확인
6. 새 토큰으로 API 재호출 성공 확인
7. 재인증 없이 정상 응답 수신

**예상 결과**:
- 토큰 자동 갱신
- API 호출 투명하게 재시도
- 사용자 경험 중단 없음

---

### IT-014: 여러 조건 동시 만족 알림 통합 시나리오
**목적**: 하나의 availability 데이터가 여러 사용자 설정 조건을 동시에 만족할 때 각각 알림 전송 검증

**전제조건**:
- 사용자 A 설정: area=["A구역"], dateFrom=2025-05-01, dateTo=2025-05-05
- 사용자 B 설정: area=["A구역", "B구역"], dateFrom=2025-05-01, dateTo=2025-05-10

**테스트 단계**:
1. availability 데이터 생성: area="A구역", date=2025-05-02
2. checkAndNotify() 실행
3. 사용자 A에게 이메일 전송 확인
4. 사용자 B에게 이메일 전송 확인
5. notifications 컬렉션에 2개의 로그 생성 확인
6. 각 사용자의 설정 isActive=false 변경 확인

**예상 결과**:
- 2명 모두에게 알림 전송
- 각각 독립적인 로그 생성
- 각 설정 자동 비활성화

---

### IT-015: 전체 시스템 End-to-End 통합 시나리오
**목적**: 신규 사용자 가입부터 알림 수신까지 전체 플로우 검증

**전제조건**:
- 시스템 초기 상태
- 테스트용 이메일 계정 준비

**테스트 단계**:
1. 신규 사용자 회원가입 (test-user@example.com)
2. 로그인 성공 및 대시보드 진입
3. 프로필 설정 (notificationEmail: test-notify@example.com)
4. 알림 설정 생성:
   - campingName: "다리안계곡캠핑장"
   - region: "경기"
   - area: ["A구역"]
   - dateFrom: 현재일 + 7일
   - dateTo: 현재일 + 10일
   - isActive: true
5. 설정 저장 확인
6. 스케줄러 대기 (10분) 또는 수동 실행
7. 스크래핑 실행 및 데이터 저장 확인
8. 조건 매칭 확인 (A구역, 날짜 범위 내)
9. 이메일 전송 및 수신 확인 (test-notify@example.com)
10. 대시보드에서 알림 로그 확인
11. 설정 자동 비활성화 확인
12. 예약 현황에서 해당 데이터 조회
13. 스크래핑 로그에서 실행 이력 확인
14. 로그아웃 및 재로그인
15. 모든 데이터 유지 확인

**예상 결과**:
- 전체 플로우 정상 동작
- 데이터 일관성 유지
- 알림 정확히 전송
- UI/API 완벽 연동

---

## 3. 테스트 실행 방법

### 3.1 단위 테스트 실행 (향후 구현)

현재 프로젝트에는 테스트 프레임워크가 설정되어 있지 않습니다. 아래는 향후 테스트 추가 시 권장사항입니다.

#### 프론트엔드 단위 테스트
```bash
cd frontend
npm install --save-dev vitest @testing-library/react @testing-library/jest-dom
npm test
```

**권장 도구**:
- Vitest: 빠른 테스트 실행
- React Testing Library: 컴포넌트 테스트
- MSW (Mock Service Worker): API 모킹

#### 백엔드 단위 테스트
```bash
cd backend
npm install --save-dev jest supertest
npm test
```

**권장 도구**:
- Jest: 테스트 프레임워크
- Supertest: HTTP API 테스트
- Firebase Emulator: Firestore 모킹

### 3.2 통합 테스트 실행

#### 수동 테스트
1. 백엔드 서버 시작:
```bash
cd backend
npm run dev
```

2. 프론트엔드 서버 시작:
```bash
cd frontend
npm run dev
```

3. 브라우저에서 http://localhost:5173 접속
4. 각 통합 시나리오 단계별 수동 실행

#### 자동화 테스트 (향후 구현)
```bash
# E2E 테스트 (Playwright 또는 Cypress)
npm install --save-dev @playwright/test
npx playwright test
```

### 3.3 테스트 환경 설정

#### .env.test 파일 생성 (백엔드)
```
PORT=3001
NODE_ENV=test
EMAIL_USER=test@example.com
EMAIL_APP_PASSWORD=test-password
```

#### Firebase Emulator 실행
```bash
firebase emulators:start --only firestore,auth
```

### 3.4 테스트 체크리스트

#### 테스트 전 확인사항
- [ ] 백엔드 서버 실행 중
- [ ] 프론트엔드 서버 실행 중
- [ ] Firebase 서비스 계정 설정 완료
- [ ] Gmail SMTP 설정 완료
- [ ] Playwright 브라우저 설치 완료
- [ ] 테스트용 계정 준비

#### 테스트 후 정리
- [ ] 테스트 데이터 Firestore에서 삭제
- [ ] 테스트 이메일 확인 및 정리
- [ ] 로그 파일 확인
- [ ] 백그라운드 프로세스 종료 확인

---

## 4. 테스트 결과 기록

### 단위 테스트 결과
| 테스트ID | 실행일 | 결과 | 비고 |
|---------|--------|------|------|
| TC-FE-001-01 | - | - | 미구현 |
| TC-BE-001-01 | - | - | 미구현 |

### 통합 테스트 결과
| 시나리오ID | 실행일 | 결과 | 비고 |
|-----------|--------|------|------|
| IT-001 | - | - | 미실행 |
| IT-015 | - | - | 미실행 |

**결과 범례**:
- PASS: 테스트 성공
- FAIL: 테스트 실패
- SKIP: 테스트 건너뜀
- BLOCK: 블로커 이슈로 테스트 불가

---

## 5. 이슈 및 개선사항

### 발견된 이슈
| 이슈ID | 발견일 | 내용 | 우선순위 | 상태 |
|-------|--------|------|---------|------|
| - | - | - | - | - |

### 개선 제안
| 제안ID | 제안일 | 내용 | 우선순위 | 상태 |
|-------|--------|------|---------|------|
| IMP-001 | - | Jest/Vitest 테스트 프레임워크 도입 | 높음 | 대기 |
| IMP-002 | - | Firebase Emulator 활용 테스트 환경 구축 | 높음 | 대기 |
| IMP-003 | - | E2E 테스트 자동화 (Playwright) | 중간 | 대기 |
| IMP-004 | - | CI/CD 파이프라인에 자동 테스트 통합 | 중간 | 대기 |

---

**문서 버전**: 1.0
**최종 수정일**: 2025-10-13
**작성자**: Test Engineer
